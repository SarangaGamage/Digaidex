<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Biometric Authentication (WebAuthn)</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 20px;
        }
        button {
            padding: 10px 20px;
            margin: 10px;
            font-size: 16px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h2>WebAuthn Biometric Authentication</h2>
    <button onclick="registerBiometricCredential()">Register Biometrics</button>
    <button onclick="authenticateWithBiometrics()">Login with Biometrics</button>

    <p id="status"></p>

    <script>
        async function registerBiometricCredential() {
            if (!window.PublicKeyCredential) {
                document.getElementById("status").innerText = "Biometric authentication is not supported on this device.";
                return;
            }

            const challenge = new Uint8Array(32); // Normally generated by the server
            const userId = new Uint8Array(16); // Unique User ID from server

            try {
                const credential = await navigator.credentials.create({
                    publicKey: {
                        challenge: challenge,
                        rp: { name: "My Secure App" },
                        user: {
                            id: userId,
                            name: "user@example.com",
                            displayName: "User Example"
                        },
                        pubKeyCredParams: [{ type: "public-key", alg: -7 }], // -7 (ES256) for elliptic curve
                        authenticatorSelection: { userVerification: "required" },
                        timeout: 60000,
                        attestation: "none"
                    }
                });

                console.log("Biometric Credential Registered!", credential);
                document.getElementById("status").innerText = "Biometric Registration Successful!";
            } catch (error) {
                console.error("Biometric Registration Failed:", error);
                document.getElementById("status").innerText = "Biometric Registration Failed!";
            }
        }

        async function authenticateWithBiometrics() {
            if (!window.PublicKeyCredential) {
                document.getElementById("status").innerText = "Biometric authentication is not supported on this device.";
                return;
            }

            const challenge = new Uint8Array(32); // Normally comes from the server

            try {
                const assertion = await navigator.credentials.get({
                    publicKey: {
                        challenge: challenge,
                        userVerification: "required"
                    }
                });

                console.log("Biometric authentication successful!", assertion);
                document.getElementById("status").innerText = "Login Successful!";
            } catch (error) {
                console.error("Biometric authentication failed:", error);
                document.getElementById("status").innerText = "Login Failed!";
            }
        }
    </script>
</body>
</html>
